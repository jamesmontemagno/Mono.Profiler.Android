<Project>
  <Target Name="_EnableMonoProfiling">

  </Target>
  <Target Name="StartProfiling">
    <ItemGroup>
      <AndroidEnvironment Include="$(MSBuildThisFileDirectory)AndroidEnvironment.txt" />
      <AndroidNativeLibrary Include="$(MSBuildThisFileDirectory)android-arm\libmono-profiler-log.so" />
      <AndroidNativeLibrary Include="$(MSBuildThisFileDirectory)android-arm64\libmono-profiler-log.so" />
      <AndroidNativeLibrary Include="$(MSBuildThisFileDirectory)android-x86\libmono-profiler-log.so" />
      <AndroidNativeLibrary Include="$(MSBuildThisFileDirectory)android-x64\libmono-profiler-log.so" />
    </ItemGroup>
    <CallTarget Targets="Clean;Run" />
    <Message Text="Application is running. Run the StopProfiling target to collect the log." Importance="High" />
  </Target>
  <Target Name="StopProfiling" DependsOnTargets="_ResolveSdks">
    <Exec Command="adb shell am force-stop $(ApplicationId)"   WorkingDirectory="$(AndroidSdkDirectory)/platform-tools"  />
    <Exec Command="adb pull /sdcard/Download/profile.mlpd"     WorkingDirectory="$(AndroidSdkDirectory)/platform-tools"  />
    <Exec Command="adb shell rm /sdcard/Download/profile.mlpd" WorkingDirectory="$(AndroidSdkDirectory)/platform-tools"  />
    <Message Text="Application stopped. See 'profile.mlpd' in the current directory." Importance="High" />
  </Target>
</Project>